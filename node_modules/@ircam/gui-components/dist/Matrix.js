'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

var _BaseComponent2 = require('./BaseComponent');

var _BaseComponent3 = _interopRequireDefault(_BaseComponent2);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return call && (typeof call === "object" || typeof call === "function") ? call : self; }

function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

var ns = 'http://www.w3.org/2000/svg';

var Matrix = function (_BaseComponent) {
  _inherits(Matrix, _BaseComponent);

  function Matrix(options) {
    _classCallCheck(this, Matrix);

    var _this = _possibleConstructorReturn(this, (Matrix.__proto__ || Object.getPrototypeOf(Matrix)).call(this));

    var defaults = {
      callback: function callback() {},
      container: 'body',
      numCols: 4,
      numRows: 4,
      width: 400,
      height: 400
      // trigger: 'touch', // 'aftertouch'
    };

    _this.params = Object.assign({}, defaults, options);

    _this._$svg = null;
    _this._$cells = null;

    _this._onMouseDown = _this._onMouseDown.bind(_this);
    _this._onMouseMove = _this._onMouseMove.bind(_this);
    _this._onMouseUp = _this._onMouseUp.bind(_this);

    _this._createValue();
    _this._createElement();
    _this._render();
    return _this;
  }

  _createClass(Matrix, [{
    key: 'setValues',


    // set values(values) {
    //   this._values = values;

    //   this.params.callback(this._values);
    //   this._render();
    // }

    value: function setValues(values) {
      var _ref = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {},
          _ref$silent = _ref.silent,
          silent = _ref$silent === undefined ? false : _ref$silent;

      this._values = values;

      if (silent === false) {
        this.params.callback(this._values);
      }

      this._render();
    }
  }, {
    key: 'setCellValue',
    value: function setCellValue(x, y, value) {
      var _ref2 = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : {},
          _ref2$silent = _ref2.silent,
          silent = _ref2$silent === undefined ? false : _ref2$silent;

      this._values[x][y] = value;
      // dispatch value

      if (silent === false) {
        this.params.callback(this._values);
      }

      this._render();
    }
  }, {
    key: 'toggleCell',
    value: function toggleCell(x, y) {
      var _ref3 = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {},
          _ref3$silent = _ref3.silent,
          silent = _ref3$silent === undefined ? false : _ref3$silent;

      var value = this._values[x][y];
      this.setCellValue(x, y, 1 - value);
    }
  }, {
    key: 'setParameter',
    value: function setParameter(name, value) {
      // ...
      if (this.params[name]) this.params[name] = value;
    }
  }, {
    key: 'reset',
    value: function reset() {
      var _params = this.params,
          numCols = _params.numCols,
          numRows = _params.numRows;


      for (var x = 0; x < numCols; x++) {
        for (var y = 0; y < numRows; y++) {
          this._values[x][y] = 0;
        }
      }

      this.params.callback(this._values);
      this._render();
    }
  }, {
    key: 'resize',
    value: function resize() {
      var width = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : null;
      var height = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;

      if (width !== null) {
        this.params.width = width;
      }

      if (height !== null) {
        this.params.height = height;
      }

      this._resizeElement();
    }
  }, {
    key: '_createValue',
    value: function _createValue() {
      var _params2 = this.params,
          numCols = _params2.numCols,
          numRows = _params2.numRows;


      this._values = [];
      // define if row first or colFirst
      for (var x = 0; x < numCols; x++) {
        var col = [];

        for (var y = 0; y < numRows; y++) {
          col[y] = 0;
        }

        this._values[x] = col;
      }
    }
  }, {
    key: '_onMouseDown',
    value: function _onMouseDown(e) {
      this._$svg.addEventListener('mousemove', this._onMouseMove);
      window.addEventListener('mouseup', this._onMouseUp);

      var $cell = e.target;
      var _$cell$dataset = $cell.dataset,
          x = _$cell$dataset.x,
          y = _$cell$dataset.y;


      this.toggleCell(x, y);
      this._$lastCell = $cell;
    }
  }, {
    key: '_onMouseMove',
    value: function _onMouseMove(e) {
      var $cell = e.target;

      if (this._$lastCell !== $cell) {
        var _$cell$dataset2 = $cell.dataset,
            x = _$cell$dataset2.x,
            y = _$cell$dataset2.y;


        this.toggleCell(x, y);
        this._$lastCell = $cell;
      }
    }
  }, {
    key: '_onMouseUp',
    value: function _onMouseUp() {
      this._$svg.removeEventListener('mousemove', this._onMouseMove);
      window.removeEventListener('mouseup', this._onMouseUp);
    }
  }, {
    key: '_createElement',
    value: function _createElement() {
      var _params3 = this.params,
          container = _params3.container,
          numCols = _params3.numCols,
          numRows = _params3.numRows;

      this._$svg = document.createElementNS(ns, 'svg');
      this._$svg.setAttributeNS(null, 'shape-rendering', 'optimizeSpeed');
      this._$svg.setAttribute('xmlns:xhtml', 'http://www.w3.org/1999/xhtml');

      this._$cells = [];

      for (var x = 0; x < numCols; x++) {
        var $coll = [];

        for (var y = 0; y < numRows; y++) {
          var $cell = document.createElementNS(ns, 'rect');
          // $cell.style.stroke = '#787878';
          $cell.setAttributeNS(null, 'stroke', '#787878');
          $cell.dataset.x = x;
          $cell.dataset.y = y;

          $coll[y] = $cell;
          this._$svg.appendChild($cell);
        }

        this._$cells[x] = $coll;
      }

      this._resizeElement();

      var $container = void 0;
      if (container instanceof Element) {
        $container = container;
      } else {
        $container = document.querySelector(container);
      }

      $container.appendChild(this._$svg);

      this._$svg.addEventListener('mousedown', this._onMouseDown);
    }
  }, {
    key: '_resizeElement',
    value: function _resizeElement() {
      var _params4 = this.params,
          numCols = _params4.numCols,
          numRows = _params4.numRows,
          width = _params4.width,
          height = _params4.height;


      this._$svg.style.width = width + 'px';
      this._$svg.style.height = height + 'px';

      var cellWidth = width / numCols;
      var cellHeight = height / numRows;

      for (var x = 0; x < numCols; x++) {
        for (var y = 0; y < numRows; y++) {
          var $cell = this._$cells[x][y];
          $cell.setAttribute('width', cellWidth);
          $cell.setAttribute('height', cellHeight);
          $cell.setAttribute('x', cellWidth * x);
          $cell.setAttribute('y', cellHeight * y);
        }
      }
    }
  }, {
    key: '_render',
    value: function _render() {
      var _params5 = this.params,
          numCols = _params5.numCols,
          numRows = _params5.numRows;


      for (var x = 0; x < numCols; x++) {
        for (var y = 0; y < numRows; y++) {
          var $cell = this._$cells[x][y];
          var value = this._values[x][y];

          if (value > 0) {
            $cell.setAttributeNS(null, 'fill', '#ffffff');
            $cell.setAttributeNS(null, 'fill-opacity', value);
          } else {
            $cell.setAttributeNS(null, 'fill', '#000000');
            $cell.setAttributeNS(null, 'fill-opacity', 1);
          }
        }
      }
    }
  }, {
    key: 'values',
    get: function get() {
      return this._values;
    }
  }]);

  return Matrix;
}(_BaseComponent3.default);

exports.default = Matrix;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluZGV4LmpzIl0sIm5hbWVzIjpbIm5zIiwiTWF0cml4Iiwib3B0aW9ucyIsImRlZmF1bHRzIiwiY2FsbGJhY2siLCJjb250YWluZXIiLCJudW1Db2xzIiwibnVtUm93cyIsIndpZHRoIiwiaGVpZ2h0IiwicGFyYW1zIiwiT2JqZWN0IiwiYXNzaWduIiwiXyRzdmciLCJfJGNlbGxzIiwiX29uTW91c2VEb3duIiwiYmluZCIsIl9vbk1vdXNlTW92ZSIsIl9vbk1vdXNlVXAiLCJfY3JlYXRlVmFsdWUiLCJfY3JlYXRlRWxlbWVudCIsIl9yZW5kZXIiLCJ2YWx1ZXMiLCJzaWxlbnQiLCJfdmFsdWVzIiwieCIsInkiLCJ2YWx1ZSIsInNldENlbGxWYWx1ZSIsIm5hbWUiLCJfcmVzaXplRWxlbWVudCIsImNvbCIsImUiLCJhZGRFdmVudExpc3RlbmVyIiwid2luZG93IiwiJGNlbGwiLCJ0YXJnZXQiLCJkYXRhc2V0IiwidG9nZ2xlQ2VsbCIsIl8kbGFzdENlbGwiLCJyZW1vdmVFdmVudExpc3RlbmVyIiwiZG9jdW1lbnQiLCJjcmVhdGVFbGVtZW50TlMiLCJzZXRBdHRyaWJ1dGVOUyIsInNldEF0dHJpYnV0ZSIsIiRjb2xsIiwiYXBwZW5kQ2hpbGQiLCIkY29udGFpbmVyIiwiRWxlbWVudCIsInF1ZXJ5U2VsZWN0b3IiLCJzdHlsZSIsImNlbGxXaWR0aCIsImNlbGxIZWlnaHQiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBQUE7Ozs7Ozs7Ozs7OztBQUdBLElBQU1BLEtBQUssNEJBQVg7O0lBR01DLE07OztBQUNKLGtCQUFZQyxPQUFaLEVBQXFCO0FBQUE7O0FBQUE7O0FBR25CLFFBQU1DLFdBQVc7QUFDZkMsZ0JBQVUsb0JBQU0sQ0FBRSxDQURIO0FBRWZDLGlCQUFXLE1BRkk7QUFHZkMsZUFBUyxDQUhNO0FBSWZDLGVBQVMsQ0FKTTtBQUtmQyxhQUFPLEdBTFE7QUFNZkMsY0FBUTtBQUNSO0FBUGUsS0FBakI7O0FBVUEsVUFBS0MsTUFBTCxHQUFjQyxPQUFPQyxN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LEVBQXdCTyxZQUFZMUIsQ0FBcEM7QUFDQVUsZ0JBQU1TLFlBQU4sQ0FBbUIsR0FBbkIsRUFBd0JRLGFBQWExQixDQUFyQztBQUNEO0FBQ0Y7QUFDRjs7OzhCQUVTO0FBQUEscUJBQ3FCLEtBQUtoQixNQUQxQjtBQUFBLFVBQ0FKLE9BREEsWUFDQUEsT0FEQTtBQUFBLFVBQ1NDLE9BRFQsWUFDU0EsT0FEVDs7O0FBR1IsV0FBSyxJQUFJa0IsSUFBSSxDQUFiLEVBQWdCQSxJQUFJbkIsT0FBcEIsRUFBNkJtQixHQUE3QixFQUFrQztBQUNoQyxhQUFLLElBQUlDLElBQUksQ0FBYixFQUFnQkEsSUFBSW5CLE9BQXBCLEVBQTZCbUIsR0FBN0IsRUFBa0M7QUFDaEMsY0FBTVMsUUFBUSxLQUFLckIsT0FBTCxDQUFhVyxDQUFiLEVBQWdCQyxDQUFoQixDQUFkO0FBQ0EsY0FBTUMsUUFBUSxLQUFLSCxPQUFMLENBQWFDLENBQWIsRUFBZ0JDLENBQWhCLENBQWQ7O0FBRUEsY0FBSUMsUUFBUSxDQUFaLEVBQWU7QUFDYlEsa0JBQU1RLGNBQU4sQ0FBcUIsSUFBckIsRUFBMkIsTUFBM0IsRUFBbUMsU0FBbkM7QUFDQVIsa0JBQU1RLGNBQU4sQ0FBcUIsSUFBckIsRUFBMkIsY0FBM0IsRUFBMkNoQixLQUEzQztBQUNELFdBSEQsTUFHTztBQUNMUSxrQkFBTVEsY0FBTixDQUFxQixJQUFyQixFQUEyQixNQUEzQixFQUFtQyxTQUFuQztBQUNBUixrQkFBTVEsY0FBTixDQUFxQixJQUFyQixFQUEyQixjQUEzQixFQUEyQyxDQUEzQztBQUNEO0FBQ0Y7QUFDRjtBQUNGOzs7d0JBNUxZO0FBQ1gsYUFBTyxLQUFLbkIsT0FBWjtBQUNEOzs7Ozs7a0JBNkxZdkIsTSIsImZpbGUiOiJpbmRleC5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBCYXNlQ29tcG9uZW50IGZyb20gJy4vQmFzZUNvbXBvbmVudCc7XG5cblxuY29uc3QgbnMgPSAnaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnO1xuXG5cbmNsYXNzIE1hdHJpeCBleHRlbmRzIEJhc2VDb21wb25lbnQge1xuICBjb25zdHJ1Y3RvcihvcHRpb25zKSB7XG4gICAgc3VwZXIoKTtcblxuICAgIGNvbnN0IGRlZmF1bHRzID0ge1xuICAgICAgY2FsbGJhY2s6ICgpID0+IHt9LFxuICAgICAgY29udGFpbmVyOiAnYm9keScsXG4gICAgICBudW1Db2xzOiA0LFxuICAgICAgbnVtUm93czogNCxcbiAgICAgIHdpZHRoOiA0MDAsXG4gICAgICBoZWlnaHQ6IDQwMCxcbiAgICAgIC8vIHRyaWdnZXI6ICd0b3VjaCcsIC8vICdhZnRlcnRvdWNoJ1xuICAgIH1cblxuICAgIHRoaXMucGFyYW1zID0gT2JqZWN0LmFzc2lnbih7fSwgZGVmYXVsdHMsIG9wdGlvbnMpO1xuXG4gICAgdGhpcy5fJHN2ZyA9IG51bGw7XG4gICAgdGhpcy5fJGNlbGxzID0gbnVsbDtcblxuICAgIHRoaXMuX29uTW91c2VEb3duID0gdGhpcy5fb25Nb3VzZURvd24uYmluZCh0aGlzKTtcbiAgICB0aGlzLl9vbk1vdXNlTW92ZSA9IHRoaXMuX29uTW91c2VNb3ZlLmJpbmQodGhpcyk7XG4gICAgdGhpcy5fb25Nb3VzZVVwID0gdGhpcy5fb25Nb3VzZVVwLmJpbmQodGhpcyk7XG5cbiAgICB0aGlzLl9jcmVhdGVWYWx1ZSgpO1xuICAgIHRoaXMuX2NyZWF0ZUVsZW1lbnQoKTtcbiAgICB0aGlzLl9yZW5kZXIoKTtcbiAgfVxuXG4gIGdldCB2YWx1ZXMoKSB7XG4gICAgcmV0dXJuIHRoaXMuX3ZhbHVlcztcbiAgfVxuXG4gIC8vIHNldCB2YWx1ZXModmFsdWVzKSB7XG4gIC8vICAgdGhpcy5fdmFsdWVzID0gdmFsdWVzO1xuXG4gIC8vICAgdGhpcy5wYXJhbXMuY2FsbGJhY2sodGhpcy5fdmFsdWVzKTtcbiAgLy8gICB0aGlzLl9yZW5kZXIoKTtcbiAgLy8gfVxuXG4gIHNldFZhbHVlcyh2YWx1ZXMsIHsgc2lsZW50ID0gZmFsc2UgfSA9IHt9KSB7XG4gICAgdGhpcy5fdmFsdWVzID0gdmFsdWVzO1xuXG4gICAgaWYgKHNpbGVudCA9PT0gZmFsc2UpIHtcbiAgICAgIHRoaXMucGFyYW1zLmNhbGxiYWNrKHRoaXMuX3ZhbHVlcyk7XG4gICAgfVxuXG4gICAgdGhpcy5fcmVuZGVyKCk7XG4gIH1cblxuICBzZXRDZWxsVmFsdWUoeCwgeSwgdmFsdWUsIHsgc2lsZW50ID0gZmFsc2XCoH0gPSB7fSkge1xuICAgIHRoaXMuX3ZhbHVlc1t4XVt5XSA9IHZhbHVlO1xuICAgIC8vIGRpc3BhdGNoIHZhbHVlXG5cbiAgICBpZiAoc2lsZW50ID09PSBmYWxzZSkge1xuICAgICAgdGhpcy5wYXJhbXMuY2FsbGJhY2sodGhpcy5fdmFsdWVzKTtcbiAgICB9XG5cbiAgICB0aGlzLl9yZW5kZXIoKTtcbiAgfVxuXG4gIHRvZ2dsZUNlbGwoeCwgeSwgeyBzaWxlbnQgPSBmYWxzZcKgfSA9IHt9KSB7XG4gICAgY29uc3QgdmFsdWUgPSB0aGlzLl92YWx1ZXNbeF1beV07XG4gICAgdGhpcy5zZXRDZWxsVmFsdWUoeCwgeSwgMSAtIHZhbHVlKTtcbiAgfVxuXG4gIHNldFBhcmFtZXRlcihuYW1lLCB2YWx1ZSkge1xuICAgIC8vIC4uLlxuICAgIGlmICh0aGlzLnBhcmFtc1tuYW1lXSlcbiAgICAgIHRoaXMucGFyYW1zW25hbWVdID0gdmFsdWU7XG4gIH1cblxuICByZXNldCgpIHtcbiAgICBjb25zdCB7IG51bUNvbHMsIG51bVJvd3MgfSA9IHRoaXMucGFyYW1zO1xuXG4gICAgZm9yIChsZXQgeCA9IDA7IHggPCBudW1Db2xzOyB4KyspIHtcbiAgICAgIGZvciAobGV0IHkgPSAwOyB5IDwgbnVtUm93czsgeSsrKSB7XG4gICAgICAgIHRoaXMuX3ZhbHVlc1t4XVt5XSA9IDA7XG4gICAgICB9XG4gICAgfVxuXG4gICAgdGhpcy5wYXJhbXMuY2FsbGJhY2sodGhpcy5fdmFsdWVzKTtcbiAgICB0aGlzLl9yZW5kZXIoKTtcbiAgfVxuXG4gIHJlc2l6ZSh3aWR0aCA9IG51bGwsIGhlaWdodCA9IG51bGwpIHtcbiAgICBpZiAod2lkdGggIT09IG51bGwpIHtcbiAgICAgIHRoaXMucGFyYW1zLndpZHRoID0gd2lkdGg7XG4gICAgfVxuXG4gICAgaWYgKGhlaWdodCAhPT0gbnVsbCkge1xuICAgICAgdGhpcy5wYXJhbXMuaGVpZ2h0ID0gaGVpZ2h0O1xuICAgIH1cblxuICAgIHRoaXMuX3Jlc2l6ZUVsZW1lbnQoKTtcbiAgfVxuXG4gIF9jcmVhdGVWYWx1ZSgpIHtcbiAgICBjb25zdCB7IG51bUNvbHMsIG51bVJvd3MgfSA9IHRoaXMucGFyYW1zO1xuXG4gICAgdGhpcy5fdmFsdWVzID0gW107XG4gICAgLy8gZGVmaW5lIGlmIHJvdyBmaXJzdCBvciBjb2xGaXJzdFxuICAgIGZvciAobGV0IHggPSAwOyB4IDwgbnVtQ29sczsgeCsrKSB7XG4gICAgICBjb25zdCBjb2wgPSBbXTtcblxuICAgICAgZm9yIChsZXQgeSA9IDA7IHkgPCBudW1Sb3dzOyB5KyspIHtcbiAgICAgICAgY29sW3ldID0gMDtcbiAgICAgIH1cblxuICAgICAgdGhpcy5fdmFsdWVzW3hdID0gY29sO1xuICAgIH1cbiAgfVxuXG4gIF9vbk1vdXNlRG93bihlKSB7XG4gICAgdGhpcy5fJHN2Zy5hZGRFdmVudExpc3RlbmVyKCdtb3VzZW1vdmUnLCB0aGlzLl9vbk1vdXNlTW92ZSk7XG4gICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNldXAnLCB0aGlzLl9vbk1vdXNlVXApO1xuXG4gICAgY29uc3QgJGNlbGwgPSBlLnRhcmdldDtcbiAgICBjb25zdCB7IHgsIHkgfSA9ICRjZWxsLmRhdGFzZXQ7XG5cbiAgICB0aGlzLnRvZ2dsZUNlbGwoeCwgeSk7XG4gICAgdGhpcy5fJGxhc3RDZWxsID0gJGNlbGw7XG4gIH1cblxuICBfb25Nb3VzZU1vdmUoZSkge1xuICAgIGNvbnN0ICRjZWxsID0gZS50YXJnZXQ7XG5cbiAgICBpZiAodGhpcy5fJGxhc3RDZWxsICE9PSAkY2VsbCkge1xuICAgICAgY29uc3QgeyB4LCB5IH0gPSAkY2VsbC5kYXRhc2V0O1xuXG4gICAgICB0aGlzLnRvZ2dsZUNlbGwoeCwgeSk7XG4gICAgICB0aGlzLl8kbGFzdENlbGwgPSAkY2VsbDtcbiAgICB9XG5cbiAgfVxuXG4gIF9vbk1vdXNlVXAoKSB7XG4gICAgdGhpcy5fJHN2Zy5yZW1vdmVFdmVudExpc3RlbmVyKCdtb3VzZW1vdmUnLCB0aGlzLl9vbk1vdXNlTW92ZSk7XG4gICAgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ21vdXNldXAnLCB0aGlzLl9vbk1vdXNlVXApO1xuICB9XG5cbiAgX2NyZWF0ZUVsZW1lbnQoKSB7XG4gICAgY29uc3QgeyBjb250YWluZXIsIG51bUNvbHMsIG51bVJvd3MgfSA9IHRoaXMucGFyYW1zO1xuICAgIHRoaXMuXyRzdmcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50TlMobnMsICdzdmcnKTtcbiAgICB0aGlzLl8kc3ZnLnNldEF0dHJpYnV0ZU5TKG51bGwsICdzaGFwZS1yZW5kZXJpbmcnLCAnb3B0aW1pemVTcGVlZCcpO1xuICAgIHRoaXMuXyRzdmcuc2V0QXR0cmlidXRlKCd4bWxuczp4aHRtbCcsICdodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hodG1sJyk7XG5cbiAgICB0aGlzLl8kY2VsbHMgPSBbXTtcblxuICAgIGZvciAobGV0IHggPSAwOyB4IDwgbnVtQ29sczsgeCsrKSB7XG4gICAgICBjb25zdCAkY29sbCA9IFtdO1xuXG4gICAgICBmb3IgKGxldCB5ID0gMDsgeSA8IG51bVJvd3M7IHkrKykge1xuICAgICAgICBjb25zdCAkY2VsbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUyhucywgJ3JlY3QnKTtcbiAgICAgICAgLy8gJGNlbGwuc3R5bGUuc3Ryb2tlID0gJyM3ODc4NzgnO1xuICAgICAgICAkY2VsbC5zZXRBdHRyaWJ1dGVOUyhudWxsLCAnc3Ryb2tlJywgJyM3ODc4NzgnKTtcbiAgICAgICAgJGNlbGwuZGF0YXNldC54ID0geDtcbiAgICAgICAgJGNlbGwuZGF0YXNldC55ID0geTtcblxuICAgICAgICAkY29sbFt5XSA9ICRjZWxsO1xuICAgICAgICB0aGlzLl8kc3ZnLmFwcGVuZENoaWxkKCRjZWxsKTtcbiAgICAgIH1cblxuICAgICAgdGhpcy5fJGNlbGxzW3hdID0gJGNvbGw7XG4gICAgfVxuXG4gICAgdGhpcy5fcmVzaXplRWxlbWVudCgpO1xuXG4gICAgbGV0ICRjb250YWluZXI7XG4gICAgaWYgKGNvbnRhaW5lciBpbnN0YW5jZW9mIEVsZW1lbnQpIHtcbiAgICAgICRjb250YWluZXIgPSBjb250YWluZXI7XG4gICAgfSBlbHNlIHtcbiAgICAgICRjb250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGNvbnRhaW5lcik7XG4gICAgfVxuXG4gICAgJGNvbnRhaW5lci5hcHBlbmRDaGlsZCh0aGlzLl8kc3ZnKTtcblxuICAgIHRoaXMuXyRzdmcuYWRkRXZlbnRMaXN0ZW5lcignbW91c2Vkb3duJywgdGhpcy5fb25Nb3VzZURvd24pO1xuICB9XG5cbiAgX3Jlc2l6ZUVsZW1lbnQoKSB7XG4gICAgY29uc3QgeyBudW1Db2xzLCBudW1Sb3dzLCB3aWR0aCwgaGVpZ2h0IH0gPSB0aGlzLnBhcmFtcztcblxuICAgIHRoaXMuXyRzdmcuc3R5bGUud2lkdGggPSBgJHt3aWR0aH1weGA7XG4gICAgdGhpcy5fJHN2Zy5zdHlsZS5oZWlnaHQgPSBgJHtoZWlnaHR9cHhgO1xuXG4gICAgY29uc3QgY2VsbFdpZHRoID0gd2lkdGggLyBudW1Db2xzO1xuICAgIGNvbnN0IGNlbGxIZWlnaHQgPSBoZWlnaHQgLyBudW1Sb3dzO1xuXG4gICAgZm9yIChsZXQgeCA9IDA7IHggPCBudW1Db2xzOyB4KyspIHtcbiAgICAgIGZvciAobGV0IHkgPSAwOyB5IDwgbnVtUm93czsgeSsrKSB7XG4gICAgICAgIGNvbnN0ICRjZWxsID0gdGhpcy5fJGNlbGxzW3hdW3ldO1xuICAgICAgICAkY2VsbC5zZXRBdHRyaWJ1dGUoJ3dpZHRoJywgY2VsbFdpZHRoKTtcbiAgICAgICAgJGNlbGwuc2V0QXR0cmlidXRlKCdoZWlnaHQnLCBjZWxsSGVpZ2h0KTtcbiAgICAgICAgJGNlbGwuc2V0QXR0cmlidXRlKCd4JywgY2VsbFdpZHRoICogeCk7XG4gICAgICAgICRjZWxsLnNldEF0dHJpYnV0ZSgneScsIGNlbGxIZWlnaHQgKiB5KTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBfcmVuZGVyKCkge1xuICAgIGNvbnN0IHsgbnVtQ29scywgbnVtUm93cyB9ID0gdGhpcy5wYXJhbXM7XG5cbiAgICBmb3IgKGxldCB4ID0gMDsgeCA8IG51bUNvbHM7IHgrKykge1xuICAgICAgZm9yIChsZXQgeSA9IDA7IHkgPCBudW1Sb3dzOyB5KyspIHtcbiAgICAgICAgY29uc3QgJGNlbGwgPSB0aGlzLl8kY2VsbHNbeF1beV07XG4gICAgICAgIGNvbnN0IHZhbHVlID0gdGhpcy5fdmFsdWVzW3hdW3ldO1xuXG4gICAgICAgIGlmICh2YWx1ZSA+IDApIHtcbiAgICAgICAgICAkY2VsbC5zZXRBdHRyaWJ1dGVOUyhudWxsLCAnZmlsbCcsICcjZmZmZmZmJyk7XG4gICAgICAgICAgJGNlbGwuc2V0QXR0cmlidXRlTlMobnVsbCwgJ2ZpbGwtb3BhY2l0eScsIHZhbHVlKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAkY2VsbC5zZXRBdHRyaWJ1dGVOUyhudWxsLCAnZmlsbCcsICcjMDAwMDAwJyk7XG4gICAgICAgICAgJGNlbGwuc2V0QXR0cmlidXRlTlMobnVsbCwgJ2ZpbGwtb3BhY2l0eScsIDEpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IE1hdHJpeDtcbiJdfQ==