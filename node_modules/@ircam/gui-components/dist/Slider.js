'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function getScale(domain, range) {
  var slope = (range[1] - range[0]) / (domain[1] - domain[0]);
  var intercept = range[0] - slope * domain[0];

  function scale(val) {
    return slope * val + intercept;
  }

  scale.invert = function (val) {
    return (val - intercept) / slope;
  };

  return scale;
}

function getClipper(min, max, step) {
  return function (val) {
    var clippedValue = Math.round(val / step) * step;
    var fixed = Math.max(Math.log10(1 / step), 0);
    var fixedValue = clippedValue.toFixed(fixed); // fix floating point errors
    return Math.min(max, Math.max(min, parseFloat(fixedValue)));
  };
}

/**
 * @module gui-components
 */

/**
 * Versatile canvas based slider.
 *
 * @param {Object} options - Override default parameters.
 * @param {'jump'|'proportionnal'|'handle'} [options.mode='jump'] - Mode of the slider:
 *  - in 'jump' mode, the value is changed on 'touchstart' or 'mousedown', and
 *    on move.
 *  - in 'proportionnal' mode, the value is updated relatively to move.
 *  - in 'handle' mode, the slider can be grabbed only around its value.
 * @param {Function} [options.callback] - Callback to be executed when the value
 *  of the slider changes.
 * @param {Number} [options.width=200] - Width of the slider.
 * @param {Number} [options.height=30] - Height of the slider.
 * @param {Number} [options.min=0] - Minimum value.
 * @param {Number} [options.max=1] - Maximum value.
 * @param {Number} [options.step=0.01] - Step between each consecutive values.
 * @param {Number} [options.default=0] - Default value.
 * @param {String|Element} [options.container='body'] - CSS Selector or DOM
 *  element in which inserting the slider.
 * @param {String} [options.backgroundColor='#464646'] - Background color of the
 *  slider.
 * @param {String} [options.foregroundColor='steelblue'] - Foreground color of
 *  the slider.
 * @param {'horizontal'|'vertical'} [options.orientation='horizontal'] -
 *  Orientation of the slider.
 * @param {Array} [options.markers=[]] - List of values where markers should
 *  be displayed on the slider.
 * @param {Boolean} [options.showHandle=true] - In 'handle' mode, define if the
 *  draggable should be show or not.
 * @param {Number} [options.handleSize=20] - Size of the draggable zone.
 * @param {String} [options.handleColor='rgba(255, 255, 255, 0.7)'] - Color of the
 *  draggable zone (when `showHandle` is `true`).
 *
 * @example
 * import { Slider} from 'gui-components';
 *
 * const slider = new Slider({
 *   mode: 'jump',
 *   container: '#container',
 *   default: 0.6,
 *   markers: [0.5],
 *   callback: (value) => console.log(value),
 * });
 */

var Slider = function () {
  function Slider(options) {
    _classCallCheck(this, Slider);

    var defaults = {
      mode: 'jump',
      callback: function callback(value) {},
      width: 200,
      height: 30,
      min: 0,
      max: 1,
      step: 0.01,
      default: 0,
      container: 'body',
      backgroundColor: '#464646',
      foregroundColor: 'steelblue',
      orientation: 'horizontal',
      markers: [],

      // handle specific options
      showHandle: true,
      handleSize: 20,
      handleColor: 'rgba(255, 255, 255, 0.7)'
    };

    this.params = Object.assign({}, defaults, options);
    this._boundingClientRect = null;
    this._touchId = null;
    this._value = null;
    this._canvasWidth = null;
    this._canvasHeight = null;
    // for proportionnal mode
    this._currentMousePosition = { x: null, y: null };
    this._currentSliderPosition = null;

    this._onMouseDown = this._onMouseDown.bind(this);
    this._onMouseMove = this._onMouseMove.bind(this);
    this._onMouseUp = this._onMouseUp.bind(this);

    this._onTouchStart = this._onTouchStart.bind(this);
    this._onTouchMove = this._onTouchMove.bind(this);
    this._onTouchEnd = this._onTouchEnd.bind(this);

    this._onResize = this._onResize.bind(this);

    this._createElement();

    // initialize
    this._resizeElement();
    this._setScales();
    this._bindEvents();
    this._onResize();
    this._updateValue(this.params.default, true, true);

    window.addEventListener('resize', this._onResize);
  }

  /**
   * Current value of the slider.
   *
   * @type {Number}
   */


  _createClass(Slider, [{
    key: 'reset',


    /**
     * Reset the slider to its default value.
     */
    value: function reset() {
      this._updateValue(this.params.default);
    }

    /**
     * Resize the slider.
     *
     * @param {Number} width - New width of the slider.
     * @param {Number} height - New height of the slider.
     */

  }, {
    key: 'resize',
    value: function resize(width, height) {
      this.params.width = width;
      this.params.height = height;

      this._resizeElement();
      this._setScales();
      this._onResize();
      this._updateValue(this._value, true, true);
    }
  }, {
    key: '_updateValue',
    value: function _updateValue(value) {
      var _this = this;

      var silent = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;
      var forceRender = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;
      var callback = this.params.callback;

      var clippedValue = this.clipper(value);

      // resize render but don't trigger callback
      if (clippedValue === this._value && forceRender === true) requestAnimationFrame(function () {
        return _this._render(clippedValue);
      });

      // trigger callback
      if (clippedValue !== this._value) {
        this._value = clippedValue;

        if (!silent) callback(clippedValue);

        requestAnimationFrame(function () {
          return _this._render(clippedValue);
        });
      }
    }
  }, {
    key: '_createElement',
    value: function _createElement() {
      var container = this.params.container;

      this.$canvas = document.createElement('canvas');
      this.ctx = this.$canvas.getContext('2d');

      if (container instanceof Element) this.$container = container;else this.$container = document.querySelector(container);

      this.$container.appendChild(this.$canvas);
    }
  }, {
    key: '_resizeElement',
    value: function _resizeElement() {
      var _params = this.params,
          width = _params.width,
          height = _params.height;

      // logical and pixel size of the canvas

      this._pixelRatio = function (ctx) {
        var dPR = window.devicePixelRatio || 1;
        var bPR = ctx.webkitBackingStorePixelRatio || ctx.mozBackingStorePixelRatio || ctx.msBackingStorePixelRatio || ctx.oBackingStorePixelRatio || ctx.backingStorePixelRatio || 1;

        return dPR / bPR;
      }(this.ctx);

      this._canvasWidth = width * this._pixelRatio;
      this._canvasHeight = height * this._pixelRatio;

      this.ctx.canvas.width = this._canvasWidth;
      this.ctx.canvas.height = this._canvasHeight;
      this.ctx.canvas.style.width = width + 'px';
      this.ctx.canvas.style.height = height + 'px';
    }
  }, {
    key: '_onResize',
    value: function _onResize() {
      this._boundingClientRect = this.$canvas.getBoundingClientRect();
    }
  }, {
    key: '_setScales',
    value: function _setScales() {
      var _params2 = this.params,
          orientation = _params2.orientation,
          width = _params2.width,
          height = _params2.height,
          min = _params2.min,
          max = _params2.max,
          step = _params2.step;
      // define transfert functions

      var screenSize = orientation === 'horizontal' ? width : height;

      var canvasSize = orientation === 'horizontal' ? this._canvasWidth : this._canvasHeight;

      var domain = orientation === 'horizontal' ? [min, max] : [max, min];
      var screenRange = [0, screenSize];
      var canvasRange = [0, canvasSize];

      this.screenScale = getScale(domain, screenRange);
      this.canvasScale = getScale(domain, canvasRange);
      this.clipper = getClipper(min, max, step);
    }
  }, {
    key: '_bindEvents',
    value: function _bindEvents() {
      this.$canvas.addEventListener('mousedown', this._onMouseDown);
      this.$canvas.addEventListener('touchstart', this._onTouchStart, { passive: false });
    }
  }, {
    key: '_onStart',
    value: function _onStart(x, y) {
      var started = null;

      switch (this.params.mode) {
        case 'jump':
          this._updatePosition(x, y);
          started = true;
          break;
        case 'proportionnal':
          this._currentMousePosition.x = x;
          this._currentMousePosition.y = y;
          started = true;
          break;
        case 'handle':
          var orientation = this.params.orientation;
          var position = this.screenScale(this._value);
          var compare = orientation === 'horizontal' ? x : y;
          var delta = this.params.handleSize / 2;

          if (compare < position + delta && compare > position - delta) {
            this._currentMousePosition.x = x;
            this._currentMousePosition.y = y;
            started = true;
          } else {
            started = false;
          }
          break;
      }

      return started;
    }
  }, {
    key: '_onMove',
    value: function _onMove(x, y) {
      switch (this.params.mode) {
        case 'jump':
          break;
        case 'proportionnal':
        case 'handle':
          var deltaX = x - this._currentMousePosition.x;
          var deltaY = y - this._currentMousePosition.y;
          this._currentMousePosition.x = x;
          this._currentMousePosition.y = y;

          x = this.screenScale(this._value) + deltaX;
          y = this.screenScale(this._value) + deltaY;
          break;
      }

      this._updatePosition(x, y);
    }
  }, {
    key: '_onEnd',
    value: function _onEnd() {
      switch (this.params.mode) {
        case 'jump':
          break;
        case 'proportionnal':
        case 'handle':
          this._currentMousePosition.x = null;
          this._currentMousePosition.y = null;
          break;
      }
    }

    // mouse events

  }, {
    key: '_onMouseDown',
    value: function _onMouseDown(e) {
      e.preventDefault();

      var pageX = e.pageX;
      var pageY = e.pageY;
      var x = pageX - this._boundingClientRect.left;
      var y = pageY - this._boundingClientRect.top;

      if (this._onStart(x, y) === true) {
        window.addEventListener('mousemove', this._onMouseMove);
        window.addEventListener('mouseup', this._onMouseUp);
      }
    }
  }, {
    key: '_onMouseMove',
    value: function _onMouseMove(e) {
      e.preventDefault(); // prevent text selection

      var pageX = e.pageX;
      var pageY = e.pageY;
      var x = pageX - this._boundingClientRect.left;;
      var y = pageY - this._boundingClientRect.top;;

      this._onMove(x, y);
    }
  }, {
    key: '_onMouseUp',
    value: function _onMouseUp(e) {
      this._onEnd();

      window.removeEventListener('mousemove', this._onMouseMove);
      window.removeEventListener('mouseup', this._onMouseUp);
    }

    // touch events

  }, {
    key: '_onTouchStart',
    value: function _onTouchStart(e) {
      e.preventDefault();

      if (this._touchId !== null) {
        return;
      }

      // consider the last touch of the list, as another touch might have
      // occured somewhere else on the screen
      var touch = e.touches[e.touches.length - 1];
      var pageX = touch.pageX;
      var pageY = touch.pageY;
      var x = pageX - this._boundingClientRect.left;
      var y = pageY - this._boundingClientRect.top;

      if (this._onStart(x, y) === true) {
        this._touchId = touch.identifier;
        // disable touchstart
        this.$canvas.removeEventListener('touchstart', this._onTouchStart);

        window.addEventListener('touchmove', this._onTouchMove, { passive: false });
        window.addEventListener('touchend', this._onTouchEnd);
        window.addEventListener('touchcancel', this._onTouchEnd);
      }
    }
  }, {
    key: '_onTouchMove',
    value: function _onTouchMove(e) {
      var _this2 = this;

      var touches = Array.from(e.touches);
      var touch = touches.filter(function (t) {
        return t.identifier === _this2._touchId;
      })[0];

      if (touch) {
        e.preventDefault(); // prevent text selection

        var pageX = touch.pageX;
        var pageY = touch.pageY;
        var x = pageX - this._boundingClientRect.left;
        var y = pageY - this._boundingClientRect.top;

        this._onMove(x, y);
      }
    }
  }, {
    key: '_onTouchEnd',
    value: function _onTouchEnd(e) {
      var _this3 = this;

      var touches = Array.from(e.touches);
      var touch = touches.filter(function (t) {
        return t.identifier === _this3._touchId;
      })[0];

      if (touch === undefined) {
        this._onEnd();
        this._touchId = null;

        window.removeEventListener('touchmove', this._onTouchMove);
        window.removeEventListener('touchend', this._onTouchEnd);
        window.removeEventListener('touchcancel', this._onTouchEnd);
        // re-enable touchstart
        this.$canvas.addEventListener('touchstart', this._onTouchStart, { passive: false });
      }
    }
  }, {
    key: '_updatePosition',
    value: function _updatePosition(x, y) {
      var _params3 = this.params,
          orientation = _params3.orientation,
          height = _params3.height;

      var position = orientation === 'horizontal' ? x : y;
      var value = this.screenScale.invert(position);

      this._updateValue(value, false, true);
    }
  }, {
    key: '_render',
    value: function _render(clippedValue) {
      var _params4 = this.params,
          backgroundColor = _params4.backgroundColor,
          foregroundColor = _params4.foregroundColor,
          orientation = _params4.orientation;

      var canvasPosition = Math.round(this.canvasScale(clippedValue));
      var width = this._canvasWidth;
      var height = this._canvasHeight;
      var ctx = this.ctx;

      ctx.save();
      ctx.clearRect(0, 0, width, height);

      // background
      ctx.fillStyle = backgroundColor;
      ctx.fillRect(0, 0, width, height);

      // foreground
      ctx.fillStyle = foregroundColor;

      if (orientation === 'horizontal') ctx.fillRect(0, 0, canvasPosition, height);else ctx.fillRect(0, canvasPosition, width, height);

      // markers
      var markers = this.params.markers;

      for (var i = 0; i < markers.length; i++) {
        var marker = markers[i];
        var position = this.canvasScale(marker);
        ctx.strokeStyle = 'rgba(255, 255, 255, 0.7)';
        ctx.beginPath();

        if (orientation === 'horizontal') {
          ctx.moveTo(position - 0.5, 1);
          ctx.lineTo(position - 0.5, height - 1);
        } else {
          ctx.moveTo(1, height - position + 0.5);
          ctx.lineTo(width - 1, height - position + 0.5);
        }

        ctx.closePath();
        ctx.stroke();
      }

      // handle mode
      if (this.params.mode === 'handle' && this.params.showHandle) {
        var delta = this.params.handleSize * this._pixelRatio / 2;
        var start = canvasPosition - delta;
        var end = canvasPosition + delta;

        ctx.globalAlpha = 1;
        ctx.fillStyle = this.params.handleColor;

        if (orientation === 'horizontal') {
          ctx.fillRect(start, 0, end - start, height);
        } else {
          ctx.fillRect(0, start, width, end - start);
        }
      }

      ctx.restore();
    }
  }, {
    key: 'value',
    get: function get() {
      return this._value;
    },
    set: function set(val) {
      // don't trigger the callback when value is set from outside
      this._updateValue(val, true, false);
    }
  }]);

  return Slider;
}();

exports.default = Slider;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluZGV4LmpzIl0sIm5hbWVzIjpbImdldFNjYWxlIiwiZG9tYWluIiwicmFuZ2UiLCJzbG9wZSIsImludGVyY2VwdCIsInNjYWxlIiwidmFsIiwiaW52ZXJ0IiwiZ2V0Q2xpcHBlciIsIm1pbiIsIm1heCIsInN0ZXAiLCJjbGlwcGVkVmFsdWUiLCJNYXRoIiwicm91bmQiLCJmaXhlZCIsImxvZzEwIiwiZml4ZWRWYWx1ZSIsInRvRml4ZWQiLCJwYXJzZUZsb2F0IiwiU2xpZGVyIiwib3B0aW9ucyIsImRlZmF1bHRzIiwibW9kZSIsImNhbGxiYWNrIiwid2lkdGgiLCJoZWlnaHQiLCJkZWZhdWx0IiwiY29udGFpbmVyIiwiYmFja2dyb3VuZENvbG9yIiwiZm9yZWdyb3VuZENvbG9yIiwib3JpZW50YXRpb24iLCJtYXJrZXJzIiwic2hvd0hhbmRsZSIsImhhbmRsZVNpemUiLCJoYW5kbGVDb2xvciIsInBhcmFtcyIsIk9iamVjdCIsImFzc2lnbiIsIl9ib3VuZGluZ0NsaWVudFJlY3QiLCJfdG91Y2hJZCIsIl92YWx1ZSIsIl9jYW52YXNXaWR0aCIsIl9jYW52YXNIZWlnaHQiLCJfY3VycmVudE1vdXNlUG9zaXRpb24iLCJ4IiwieSIsIl9jdXJyZW50U2xpZGVyUG9zaXRpb24iLCJfb25Nb3VzZURvd24iLCJiaW5kIiwiX29uTW91c2VNb3ZlIiwiX29uTW91c2VVcCIsIl9vblRvdWNoU3RhcnQiLCJfb25Ub3VjaE1vdmUiLCJfb25Ub3VjaEVuZCIsIl9vblJlc2l6ZSIsIl9jcmVhdGVFbGVtZW50IiwiX3Jlc2l6ZUVsZW1lbnQiLCJfc2V0U2NhbGVzIiwiX2JpbmRFdmVudHMiLCJfdXBkYXRlVmFsdWUiLCJ3aW5kb3ciLCJhZGRFdmVudExpc3RlbmVyIiwidmFsdWUiLCJzaWxlbnQiLCJmb3JjZVJlbmRlciIsImNsaXBwZXIiLCJyZXF1ZXN0QW5pbWF0aW9uRnJhbWUiLCJfcmVuZGVyIiwiJGNhbnZhcyIsImRvY3VtZW50IiwiY3JlYXRlRWxlbWVudCIsImN0eCIsImdldENvbnRleHQiLCJFbGVtZW50IiwiJGNvbnRhaW5lciIsInF1ZXJ5U2VsZWN0b3IiLCJhcHBlbmRDaGlsZCIsIl9waXhlbFJhdGlvIiwiZFBSIiwiZGV2aWNlUGl4ZWxSYXRpbyIsImJQUiIsIndlYmtpdEJhY2tpbmdTdG9yZVBpeGVsUmF0aW8iLCJtb3pCYWNraW5nU3RvcmVQaXhlbFJhdGlvIiwibXNCYWNraW5nU3RvcmVQaXhlbFJhdGlvIiwib0JhY2tpbmdTdG9yZVBpeGVsUmF0aW8iLCJiYWNraW5nU3RvcmVQaXhlbFJhdGlvIiwiY2FudmFzIiwic3R5bGUiLCJnZXRCb3VuZGluZ0NsaWVudFJlY3QiLCJzY3JlZW5TaXplIiwiY2FudmFzU2l6ZSIsInNjcmVlblJhbmdlIiwiY2FudmFzUmFuZ2UiLCJzY3JlZW5TY2FsZSIsImNhbnZhc1NjYWxlIiwicGFzc2l2ZSIsInN0YXJ0ZWQiLCJfdXBkYXRlUG9zaXRpb24iLCJwb3NpdGlvbiIsImNvbXBhcmUiLCJkZWx0YSIsImRlbHRhWCIsImRlbHRhWSIsImUiLCJwcmV2ZW50RGVmYXVsdCIsInBhZ2VYIiwicGFnZVkiLCJsZWZ0IiwidG9wIiwiX29uU3RhcnQiLCJfb25Nb3ZlIiwiX29uRW5kIiwicmVtb3ZlRXZlbnRMaXN0ZW5lciIsInRvdWNoIiwidG91Y2hlcyIsImxlbmd0aCIsImlkZW50aWZpZXIiLCJBcnJheSIsImZyb20iLCJmaWx0ZXIiLCJ0IiwidW5kZWZpbmVkIiwiY2FudmFzUG9zaXRpb24iLCJzYXZlIiwiY2xlYXJSZWN0IiwiZmlsbFN0eWxlIiwiZmlsbFJlY3QiLCJpIiwibWFya2VyIiwic3Ryb2tlU3R5bGUiLCJiZWdpblBhdGgiLCJtb3ZlVG8iLCJsaW5lVG8iLCJjbG9zZVBhdGgiLCJzdHJva2UiLCJzdGFydCIsImVuZCIsImdsb2JhbEFscGhhIiwicmVzdG9yZSJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7OztBQUFBLFNBQVNBLFFBQVQsQ0FBa0JDLE1BQWxCLEVBQTBCQyxLQUExQixFQUFpQztBQUMvQixNQUFNQyxR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QUo7QUFDRDs7O3dCQWxWVztBQUNWLGFBQU8sS0FBS2xHLE1BQVo7QUFDRCxLO3NCQUVTbkMsRyxFQUFLO0FBQ2I7QUFDQSxXQUFLc0QsWUFBTCxDQUFrQnRELEdBQWxCLEVBQXVCLElBQXZCLEVBQTZCLEtBQTdCO0FBQ0Q7Ozs7OztrQkE4VVljLE0iLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VzQ29udGVudCI6WyJmdW5jdGlvbiBnZXRTY2FsZShkb21haW4sIHJhbmdlKSB7XG4gIGNvbnN0IHNsb3BlID0gKHJhbmdlWzFdIC0gcmFuZ2VbMF0pIC8gKGRvbWFpblsxXSAtIGRvbWFpblswXSk7XG4gIGNvbnN0IGludGVyY2VwdCA9IHJhbmdlWzBdIC0gc2xvcGUgKiBkb21haW5bMF07XG5cbiAgZnVuY3Rpb24gc2NhbGUodmFsKSB7XG4gICAgcmV0dXJuIHNsb3BlICogdmFsICsgaW50ZXJjZXB0O1xuICB9XG5cbiAgc2NhbGUuaW52ZXJ0ID0gZnVuY3Rpb24odmFsKSB7XG4gICAgcmV0dXJuICh2YWwgLSBpbnRlcmNlcHQpIC8gc2xvcGU7XG4gIH1cblxuICByZXR1cm4gc2NhbGU7XG59XG5cbmZ1bmN0aW9uIGdldENsaXBwZXIobWluLCBtYXgsIHN0ZXApIHtcbiAgcmV0dXJuICh2YWwpID0+IHtcbiAgICBjb25zdCBjbGlwcGVkVmFsdWUgPSBNYXRoLnJvdW5kKHZhbCAvIHN0ZXApICogc3RlcDtcbiAgICBjb25zdCBmaXhlZCA9IE1hdGgubWF4KE1hdGgubG9nMTAoMSAvIHN0ZXApLCAwKTtcbiAgICBjb25zdCBmaXhlZFZhbHVlID0gY2xpcHBlZFZhbHVlLnRvRml4ZWQoZml4ZWQpOyAvLyBmaXggZmxvYXRpbmcgcG9pbnQgZXJyb3JzXG4gICAgcmV0dXJuIE1hdGgubWluKG1heCwgTWF0aC5tYXgobWluLCBwYXJzZUZsb2F0KGZpeGVkVmFsdWUpKSk7XG4gIH1cbn1cblxuLyoqXG4gKiBAbW9kdWxlIGd1aS1jb21wb25lbnRzXG4gKi9cblxuLyoqXG4gKiBWZXJzYXRpbGUgY2FudmFzIGJhc2VkIHNsaWRlci5cbiAqXG4gKiBAcGFyYW0ge09iamVjdH0gb3B0aW9ucyAtIE92ZXJyaWRlIGRlZmF1bHQgcGFyYW1ldGVycy5cbiAqIEBwYXJhbSB7J2p1bXAnfCdwcm9wb3J0aW9ubmFsJ3wnaGFuZGxlJ30gW29wdGlvbnMubW9kZT0nanVtcCddIC0gTW9kZSBvZiB0aGUgc2xpZGVyOlxuICogIC0gaW4gJ2p1bXAnIG1vZGUsIHRoZSB2YWx1ZSBpcyBjaGFuZ2VkIG9uICd0b3VjaHN0YXJ0JyBvciAnbW91c2Vkb3duJywgYW5kXG4gKiAgICBvbiBtb3ZlLlxuICogIC0gaW4gJ3Byb3BvcnRpb25uYWwnIG1vZGUsIHRoZSB2YWx1ZSBpcyB1cGRhdGVkIHJlbGF0aXZlbHkgdG8gbW92ZS5cbiAqICAtIGluICdoYW5kbGUnIG1vZGUsIHRoZSBzbGlkZXIgY2FuIGJlIGdyYWJiZWQgb25seSBhcm91bmQgaXRzIHZhbHVlLlxuICogQHBhcmFtIHtGdW5jdGlvbn0gW29wdGlvbnMuY2FsbGJhY2tdIC0gQ2FsbGJhY2sgdG8gYmUgZXhlY3V0ZWQgd2hlbiB0aGUgdmFsdWVcbiAqICBvZiB0aGUgc2xpZGVyIGNoYW5nZXMuXG4gKiBAcGFyYW0ge051bWJlcn0gW29wdGlvbnMud2lkdGg9MjAwXSAtIFdpZHRoIG9mIHRoZSBzbGlkZXIuXG4gKiBAcGFyYW0ge051bWJlcn0gW29wdGlvbnMuaGVpZ2h0PTMwXSAtIEhlaWdodCBvZiB0aGUgc2xpZGVyLlxuICogQHBhcmFtIHtOdW1iZXJ9IFtvcHRpb25zLm1pbj0wXSAtIE1pbmltdW0gdmFsdWUuXG4gKiBAcGFyYW0ge051bWJlcn0gW29wdGlvbnMubWF4PTFdIC0gTWF4aW11bSB2YWx1ZS5cbiAqIEBwYXJhbSB7TnVtYmVyfSBbb3B0aW9ucy5zdGVwPTAuMDFdIC0gU3RlcCBiZXR3ZWVuIGVhY2ggY29uc2VjdXRpdmUgdmFsdWVzLlxuICogQHBhcmFtIHtOdW1iZXJ9IFtvcHRpb25zLmRlZmF1bHQ9MF0gLSBEZWZhdWx0IHZhbHVlLlxuICogQHBhcmFtIHtTdHJpbmd8RWxlbWVudH0gW29wdGlvbnMuY29udGFpbmVyPSdib2R5J10gLSBDU1MgU2VsZWN0b3Igb3IgRE9NXG4gKiAgZWxlbWVudCBpbiB3aGljaCBpbnNlcnRpbmcgdGhlIHNsaWRlci5cbiAqIEBwYXJhbSB7U3RyaW5nfSBbb3B0aW9ucy5iYWNrZ3JvdW5kQ29sb3I9JyM0NjQ2NDYnXSAtIEJhY2tncm91bmQgY29sb3Igb2YgdGhlXG4gKiAgc2xpZGVyLlxuICogQHBhcmFtIHtTdHJpbmd9IFtvcHRpb25zLmZvcmVncm91bmRDb2xvcj0nc3RlZWxibHVlJ10gLSBGb3JlZ3JvdW5kIGNvbG9yIG9mXG4gKiAgdGhlIHNsaWRlci5cbiAqIEBwYXJhbSB7J2hvcml6b250YWwnfCd2ZXJ0aWNhbCd9IFtvcHRpb25zLm9yaWVudGF0aW9uPSdob3Jpem9udGFsJ10gLVxuICogIE9yaWVudGF0aW9uIG9mIHRoZSBzbGlkZXIuXG4gKiBAcGFyYW0ge0FycmF5fSBbb3B0aW9ucy5tYXJrZXJzPVtdXSAtIExpc3Qgb2YgdmFsdWVzIHdoZXJlIG1hcmtlcnMgc2hvdWxkXG4gKiAgYmUgZGlzcGxheWVkIG9uIHRoZSBzbGlkZXIuXG4gKiBAcGFyYW0ge0Jvb2xlYW59IFtvcHRpb25zLnNob3dIYW5kbGU9dHJ1ZV0gLSBJbiAnaGFuZGxlJyBtb2RlLCBkZWZpbmUgaWYgdGhlXG4gKiAgZHJhZ2dhYmxlIHNob3VsZCBiZSBzaG93IG9yIG5vdC5cbiAqIEBwYXJhbSB7TnVtYmVyfSBbb3B0aW9ucy5oYW5kbGVTaXplPTIwXSAtIFNpemUgb2YgdGhlIGRyYWdnYWJsZSB6b25lLlxuICogQHBhcmFtIHtTdHJpbmd9IFtvcHRpb25zLmhhbmRsZUNvbG9yPSdyZ2JhKDI1NSwgMjU1LCAyNTUsIDAuNyknXSAtIENvbG9yIG9mIHRoZVxuICogIGRyYWdnYWJsZSB6b25lICh3aGVuIGBzaG93SGFuZGxlYCBpcyBgdHJ1ZWApLlxuICpcbiAqIEBleGFtcGxlXG4gKiBpbXBvcnQgeyBTbGlkZXJ9IGZyb20gJ2d1aS1jb21wb25lbnRzJztcbiAqXG4gKiBjb25zdCBzbGlkZXIgPSBuZXcgU2xpZGVyKHtcbiAqICAgbW9kZTogJ2p1bXAnLFxuICogICBjb250YWluZXI6ICcjY29udGFpbmVyJyxcbiAqICAgZGVmYXVsdDogMC42LFxuICogICBtYXJrZXJzOiBbMC41XSxcbiAqICAgY2FsbGJhY2s6ICh2YWx1ZSkgPT4gY29uc29sZS5sb2codmFsdWUpLFxuICogfSk7XG4gKi9cbmNsYXNzIFNsaWRlciB7XG4gIGNvbnN0cnVjdG9yKG9wdGlvbnMpIHtcbiAgICBjb25zdCBkZWZhdWx0cyA9IHtcbiAgICAgIG1vZGU6ICdqdW1wJyxcbiAgICAgIGNhbGxiYWNrOiB2YWx1ZSA9PiB7fSxcbiAgICAgIHdpZHRoOiAyMDAsXG4gICAgICBoZWlnaHQ6IDMwLFxuICAgICAgbWluOiAwLFxuICAgICAgbWF4OiAxLFxuICAgICAgc3RlcDogMC4wMSxcbiAgICAgIGRlZmF1bHQ6IDAsXG4gICAgICBjb250YWluZXI6ICdib2R5JyxcbiAgICAgIGJhY2tncm91bmRDb2xvcjogJyM0NjQ2NDYnLFxuICAgICAgZm9yZWdyb3VuZENvbG9yOiAnc3RlZWxibHVlJyxcbiAgICAgIG9yaWVudGF0aW9uOiAnaG9yaXpvbnRhbCcsXG4gICAgICBtYXJrZXJzOiBbXSxcblxuICAgICAgLy8gaGFuZGxlIHNwZWNpZmljIG9wdGlvbnNcbiAgICAgIHNob3dIYW5kbGU6IHRydWUsXG4gICAgICBoYW5kbGVTaXplOiAyMCxcbiAgICAgIGhhbmRsZUNvbG9yOiAncmdiYSgyNTUsIDI1NSwgMjU1LCAwLjcpJyxcbiAgICB9O1xuXG4gICAgdGhpcy5wYXJhbXMgPSBPYmplY3QuYXNzaWduKHt9LCBkZWZhdWx0cywgb3B0aW9ucyk7XG4gICAgdGhpcy5fYm91bmRpbmdDbGllbnRSZWN0ID0gbnVsbDtcbiAgICB0aGlzLl90b3VjaElkID0gbnVsbDtcbiAgICB0aGlzLl92YWx1ZSA9IG51bGw7XG4gICAgdGhpcy5fY2FudmFzV2lkdGggPSBudWxsO1xuICAgIHRoaXMuX2NhbnZhc0hlaWdodCA9IG51bGw7XG4gICAgLy8gZm9yIHByb3BvcnRpb25uYWwgbW9kZVxuICAgIHRoaXMuX2N1cnJlbnRNb3VzZVBvc2l0aW9uID0geyB4OiBudWxsLCB5OiBudWxsIH07XG4gICAgdGhpcy5fY3VycmVudFNsaWRlclBvc2l0aW9uID0gbnVsbDtcblxuICAgIHRoaXMuX29uTW91c2VEb3duID0gdGhpcy5fb25Nb3VzZURvd24uYmluZCh0aGlzKTtcbiAgICB0aGlzLl9vbk1vdXNlTW92ZSA9IHRoaXMuX29uTW91c2VNb3ZlLmJpbmQodGhpcyk7XG4gICAgdGhpcy5fb25Nb3VzZVVwID0gdGhpcy5fb25Nb3VzZVVwLmJpbmQodGhpcyk7XG5cbiAgICB0aGlzLl9vblRvdWNoU3RhcnQgPSB0aGlzLl9vblRvdWNoU3RhcnQuYmluZCh0aGlzKTtcbiAgICB0aGlzLl9vblRvdWNoTW92ZSA9IHRoaXMuX29uVG91Y2hNb3ZlIC5iaW5kKHRoaXMpO1xuICAgIHRoaXMuX29uVG91Y2hFbmQgPSB0aGlzLl9vblRvdWNoRW5kLmJpbmQodGhpcyk7XG5cbiAgICB0aGlzLl9vblJlc2l6ZSA9IHRoaXMuX29uUmVzaXplLmJpbmQodGhpcyk7XG5cblxuICAgIHRoaXMuX2NyZWF0ZUVsZW1lbnQoKTtcblxuICAgIC8vIGluaXRpYWxpemVcbiAgICB0aGlzLl9yZXNpemVFbGVtZW50KCk7XG4gICAgdGhpcy5fc2V0U2NhbGVzKCk7XG4gICAgdGhpcy5fYmluZEV2ZW50cygpO1xuICAgIHRoaXMuX29uUmVzaXplKCk7XG4gICAgdGhpcy5fdXBkYXRlVmFsdWUodGhpcy5wYXJhbXMuZGVmYXVsdCwgdHJ1ZSwgdHJ1ZSk7XG5cbiAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigncmVzaXplJywgdGhpcy5fb25SZXNpemUpO1xuICB9XG5cbiAgLyoqXG4gICAqIEN1cnJlbnQgdmFsdWUgb2YgdGhlIHNsaWRlci5cbiAgICpcbiAgICogQHR5cGUge051bWJlcn1cbiAgICovXG4gIGdldCB2YWx1ZSgpIHtcbiAgICByZXR1cm4gdGhpcy5fdmFsdWU7XG4gIH1cblxuICBzZXQgdmFsdWUodmFsKSB7XG4gICAgLy8gZG9uJ3QgdHJpZ2dlciB0aGUgY2FsbGJhY2sgd2hlbiB2YWx1ZSBpcyBzZXQgZnJvbSBvdXRzaWRlXG4gICAgdGhpcy5fdXBkYXRlVmFsdWUodmFsLCB0cnVlLCBmYWxzZSk7XG4gIH1cblxuICAvKipcbiAgICogUmVzZXQgdGhlIHNsaWRlciB0byBpdHMgZGVmYXVsdCB2YWx1ZS5cbiAgICovXG4gIHJlc2V0KCkge1xuICAgIHRoaXMuX3VwZGF0ZVZhbHVlKHRoaXMucGFyYW1zLmRlZmF1bHQpO1xuICB9XG5cbiAgLyoqXG4gICAqIFJlc2l6ZSB0aGUgc2xpZGVyLlxuICAgKlxuICAgKiBAcGFyYW0ge051bWJlcn0gd2lkdGggLSBOZXcgd2lkdGggb2YgdGhlIHNsaWRlci5cbiAgICogQHBhcmFtIHtOdW1iZXJ9IGhlaWdodCAtIE5ldyBoZWlnaHQgb2YgdGhlIHNsaWRlci5cbiAgICovXG4gIHJlc2l6ZSh3aWR0aCwgaGVpZ2h0KSB7XG4gICAgdGhpcy5wYXJhbXMud2lkdGggPSB3aWR0aDtcbiAgICB0aGlzLnBhcmFtcy5oZWlnaHQgPSBoZWlnaHQ7XG5cbiAgICB0aGlzLl9yZXNpemVFbGVtZW50KCk7XG4gICAgdGhpcy5fc2V0U2NhbGVzKCk7XG4gICAgdGhpcy5fb25SZXNpemUoKTtcbiAgICB0aGlzLl91cGRhdGVWYWx1ZSh0aGlzLl92YWx1ZSwgdHJ1ZSwgdHJ1ZSk7XG4gIH1cblxuICBfdXBkYXRlVmFsdWUodmFsdWUsIHNpbGVudCA9IGZhbHNlLCBmb3JjZVJlbmRlciA9IGZhbHNlKSB7XG4gICAgY29uc3QgeyBjYWxsYmFjayB9ID0gdGhpcy5wYXJhbXM7XG4gICAgY29uc3QgY2xpcHBlZFZhbHVlID0gdGhpcy5jbGlwcGVyKHZhbHVlKTtcblxuICAgIC8vIHJlc2l6ZSByZW5kZXIgYnV0IGRvbid0IHRyaWdnZXIgY2FsbGJhY2tcbiAgICBpZiAoY2xpcHBlZFZhbHVlID09PSB0aGlzLl92YWx1ZSAmJiBmb3JjZVJlbmRlciA9PT0gdHJ1ZSlcbiAgICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZSgoKSA9PiB0aGlzLl9yZW5kZXIoY2xpcHBlZFZhbHVlKSk7XG5cbiAgICAvLyB0cmlnZ2VyIGNhbGxiYWNrXG4gICAgaWYgKGNsaXBwZWRWYWx1ZSAhPT0gdGhpcy5fdmFsdWUpIHtcbiAgICAgIHRoaXMuX3ZhbHVlID0gY2xpcHBlZFZhbHVlO1xuXG4gICAgICBpZiAoIXNpbGVudClcbiAgICAgICAgY2FsbGJhY2soY2xpcHBlZFZhbHVlKTtcblxuICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKCgpID0+IHRoaXMuX3JlbmRlcihjbGlwcGVkVmFsdWUpKTtcbiAgICB9XG4gIH1cblxuICBfY3JlYXRlRWxlbWVudCgpIHtcbiAgICBjb25zdCB7IGNvbnRhaW5lciB9ID0gdGhpcy5wYXJhbXM7XG4gICAgdGhpcy4kY2FudmFzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnY2FudmFzJyk7XG4gICAgdGhpcy5jdHggPSB0aGlzLiRjYW52YXMuZ2V0Q29udGV4dCgnMmQnKTtcblxuICAgIGlmIChjb250YWluZXIgaW5zdGFuY2VvZiBFbGVtZW50KVxuICAgICAgdGhpcy4kY29udGFpbmVyID0gY29udGFpbmVyO1xuICAgIGVsc2VcbiAgICAgIHRoaXMuJGNvbnRhaW5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoY29udGFpbmVyKTtcblxuICAgIHRoaXMuJGNvbnRhaW5lci5hcHBlbmRDaGlsZCh0aGlzLiRjYW52YXMpO1xuICB9XG5cbiAgX3Jlc2l6ZUVsZW1lbnQoKSB7XG4gICAgY29uc3QgeyB3aWR0aCwgaGVpZ2h0IH0gPSB0aGlzLnBhcmFtcztcblxuICAgIC8vIGxvZ2ljYWwgYW5kIHBpeGVsIHNpemUgb2YgdGhlIGNhbnZhc1xuICAgIHRoaXMuX3BpeGVsUmF0aW8gPSAoZnVuY3Rpb24oY3R4KSB7XG4gICAgY29uc3QgZFBSID0gd2luZG93LmRldmljZVBpeGVsUmF0aW8gfHwgMTtcbiAgICBjb25zdCBiUFIgPSBjdHgud2Via2l0QmFja2luZ1N0b3JlUGl4ZWxSYXRpbyB8fFxuICAgICAgY3R4Lm1vekJhY2tpbmdTdG9yZVBpeGVsUmF0aW8gfHxcbiAgICAgIGN0eC5tc0JhY2tpbmdTdG9yZVBpeGVsUmF0aW8gfHxcbiAgICAgIGN0eC5vQmFja2luZ1N0b3JlUGl4ZWxSYXRpbyB8fFxuICAgICAgY3R4LmJhY2tpbmdTdG9yZVBpeGVsUmF0aW8gfHwgMTtcblxuICAgICAgcmV0dXJuIGRQUiAvIGJQUjtcbiAgICB9KHRoaXMuY3R4KSk7XG5cbiAgICB0aGlzLl9jYW52YXNXaWR0aCA9IHdpZHRoICogdGhpcy5fcGl4ZWxSYXRpbztcbiAgICB0aGlzLl9jYW52YXNIZWlnaHQgPSBoZWlnaHQgKiB0aGlzLl9waXhlbFJhdGlvO1xuXG4gICAgdGhpcy5jdHguY2FudmFzLndpZHRoID0gdGhpcy5fY2FudmFzV2lkdGg7XG4gICAgdGhpcy5jdHguY2FudmFzLmhlaWdodCA9IHRoaXMuX2NhbnZhc0hlaWdodDtcbiAgICB0aGlzLmN0eC5jYW52YXMuc3R5bGUud2lkdGggPSBgJHt3aWR0aH1weGA7XG4gICAgdGhpcy5jdHguY2FudmFzLnN0eWxlLmhlaWdodCA9IGAke2hlaWdodH1weGA7XG4gIH1cblxuICBfb25SZXNpemUoKSB7XG4gICAgdGhpcy5fYm91bmRpbmdDbGllbnRSZWN0ID0gdGhpcy4kY2FudmFzLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICB9XG5cbiAgX3NldFNjYWxlcygpIHtcbiAgICBjb25zdCB7IG9yaWVudGF0aW9uLCB3aWR0aCwgaGVpZ2h0LCBtaW4sIG1heCwgc3RlcCB9ID0gdGhpcy5wYXJhbXM7XG4gICAgLy8gZGVmaW5lIHRyYW5zZmVydCBmdW5jdGlvbnNcbiAgICBjb25zdCBzY3JlZW5TaXplID0gb3JpZW50YXRpb24gPT09ICdob3Jpem9udGFsJyA/XG4gICAgICB3aWR0aCA6IGhlaWdodDtcblxuICAgIGNvbnN0IGNhbnZhc1NpemUgPSBvcmllbnRhdGlvbiA9PT0gJ2hvcml6b250YWwnID9cbiAgICAgIHRoaXMuX2NhbnZhc1dpZHRoIDogdGhpcy5fY2FudmFzSGVpZ2h0O1xuXG4gICAgY29uc3QgZG9tYWluID0gb3JpZW50YXRpb24gPT09ICdob3Jpem9udGFsJyA/IFttaW4sIG1heF0gOiBbbWF4LCBtaW5dO1xuICAgIGNvbnN0IHNjcmVlblJhbmdlID0gWzAsIHNjcmVlblNpemVdO1xuICAgIGNvbnN0IGNhbnZhc1JhbmdlID0gWzAsIGNhbnZhc1NpemVdO1xuXG4gICAgdGhpcy5zY3JlZW5TY2FsZSA9IGdldFNjYWxlKGRvbWFpbiwgc2NyZWVuUmFuZ2UpO1xuICAgIHRoaXMuY2FudmFzU2NhbGUgPSBnZXRTY2FsZShkb21haW4sIGNhbnZhc1JhbmdlKTtcbiAgICB0aGlzLmNsaXBwZXIgPSBnZXRDbGlwcGVyKG1pbiwgbWF4LCBzdGVwKTtcbiAgfVxuXG4gIF9iaW5kRXZlbnRzKCkge1xuICAgIHRoaXMuJGNhbnZhcy5hZGRFdmVudExpc3RlbmVyKCdtb3VzZWRvd24nLCB0aGlzLl9vbk1vdXNlRG93bik7XG4gICAgdGhpcy4kY2FudmFzLmFkZEV2ZW50TGlzdGVuZXIoJ3RvdWNoc3RhcnQnLCB0aGlzLl9vblRvdWNoU3RhcnQsIHsgcGFzc2l2ZTogZmFsc2UgfSk7XG4gIH1cblxuICBfb25TdGFydCh4LCB5KSB7XG4gICAgbGV0IHN0YXJ0ZWQgPSBudWxsO1xuXG4gICAgc3dpdGNoICh0aGlzLnBhcmFtcy5tb2RlKSB7XG4gICAgICBjYXNlICdqdW1wJzpcbiAgICAgICAgdGhpcy5fdXBkYXRlUG9zaXRpb24oeCwgeSk7XG4gICAgICAgIHN0YXJ0ZWQgPSB0cnVlO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgJ3Byb3BvcnRpb25uYWwnOlxuICAgICAgICB0aGlzLl9jdXJyZW50TW91c2VQb3NpdGlvbi54ID0geDtcbiAgICAgICAgdGhpcy5fY3VycmVudE1vdXNlUG9zaXRpb24ueSA9IHk7XG4gICAgICAgIHN0YXJ0ZWQgPSB0cnVlO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgJ2hhbmRsZSc6XG4gICAgICAgIGNvbnN0IG9yaWVudGF0aW9uID0gdGhpcy5wYXJhbXMub3JpZW50YXRpb247XG4gICAgICAgIGNvbnN0IHBvc2l0aW9uID0gdGhpcy5zY3JlZW5TY2FsZSh0aGlzLl92YWx1ZSk7XG4gICAgICAgIGNvbnN0IGNvbXBhcmUgPSBvcmllbnRhdGlvbiA9PT0gJ2hvcml6b250YWwnID8geCA6IHk7XG4gICAgICAgIGNvbnN0IGRlbHRhID0gdGhpcy5wYXJhbXMuaGFuZGxlU2l6ZSAvIDI7XG5cbiAgICAgICAgaWYgKGNvbXBhcmUgPCBwb3NpdGlvbiArIGRlbHRhICYmIGNvbXBhcmUgPiBwb3NpdGlvbiAtIGRlbHRhKSB7XG4gICAgICAgICAgdGhpcy5fY3VycmVudE1vdXNlUG9zaXRpb24ueCA9IHg7XG4gICAgICAgICAgdGhpcy5fY3VycmVudE1vdXNlUG9zaXRpb24ueSA9IHk7XG4gICAgICAgICAgc3RhcnRlZCA9IHRydWU7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgc3RhcnRlZCA9IGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIGJyZWFrO1xuICAgIH1cblxuICAgIHJldHVybiBzdGFydGVkO1xuICB9XG5cbiAgX29uTW92ZSh4LCB5KSB7XG4gICAgc3dpdGNoICh0aGlzLnBhcmFtcy5tb2RlKSB7XG4gICAgICBjYXNlICdqdW1wJzpcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICdwcm9wb3J0aW9ubmFsJzpcbiAgICAgIGNhc2UgJ2hhbmRsZSc6XG4gICAgICAgIGNvbnN0IGRlbHRhWCA9IHggLSB0aGlzLl9jdXJyZW50TW91c2VQb3NpdGlvbi54O1xuICAgICAgICBjb25zdCBkZWx0YVkgPSB5IC0gdGhpcy5fY3VycmVudE1vdXNlUG9zaXRpb24ueTtcbiAgICAgICAgdGhpcy5fY3VycmVudE1vdXNlUG9zaXRpb24ueCA9IHg7XG4gICAgICAgIHRoaXMuX2N1cnJlbnRNb3VzZVBvc2l0aW9uLnkgPSB5O1xuXG4gICAgICAgIHggPSB0aGlzLnNjcmVlblNjYWxlKHRoaXMuX3ZhbHVlKSArIGRlbHRhWDtcbiAgICAgICAgeSA9IHRoaXMuc2NyZWVuU2NhbGUodGhpcy5fdmFsdWUpICsgZGVsdGFZO1xuICAgICAgICBicmVhaztcbiAgICB9XG5cbiAgICB0aGlzLl91cGRhdGVQb3NpdGlvbih4LCB5KTtcbiAgfVxuXG4gIF9vbkVuZCgpIHtcbiAgICBzd2l0Y2ggKHRoaXMucGFyYW1zLm1vZGUpIHtcbiAgICAgIGNhc2UgJ2p1bXAnOlxuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgJ3Byb3BvcnRpb25uYWwnOlxuICAgICAgY2FzZSAnaGFuZGxlJzpcbiAgICAgICAgdGhpcy5fY3VycmVudE1vdXNlUG9zaXRpb24ueCA9IG51bGw7XG4gICAgICAgIHRoaXMuX2N1cnJlbnRNb3VzZVBvc2l0aW9uLnkgPSBudWxsO1xuICAgICAgICBicmVhaztcbiAgICB9XG4gIH1cblxuICAvLyBtb3VzZSBldmVudHNcbiAgX29uTW91c2VEb3duKGUpIHtcbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XG5cbiAgICBjb25zdCBwYWdlWCA9IGUucGFnZVg7XG4gICAgY29uc3QgcGFnZVkgPSBlLnBhZ2VZO1xuICAgIGNvbnN0IHggPSBwYWdlWCAtIHRoaXMuX2JvdW5kaW5nQ2xpZW50UmVjdC5sZWZ0O1xuICAgIGNvbnN0IHkgPSBwYWdlWSAtIHRoaXMuX2JvdW5kaW5nQ2xpZW50UmVjdC50b3A7XG5cbiAgICBpZiAodGhpcy5fb25TdGFydCh4LCB5KSA9PT0gdHJ1ZSkge1xuICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlbW92ZScsIHRoaXMuX29uTW91c2VNb3ZlKTtcbiAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdtb3VzZXVwJywgdGhpcy5fb25Nb3VzZVVwKTtcbiAgICB9XG4gIH1cblxuICBfb25Nb3VzZU1vdmUoZSkge1xuICAgIGUucHJldmVudERlZmF1bHQoKTsgLy8gcHJldmVudCB0ZXh0IHNlbGVjdGlvblxuXG4gICAgY29uc3QgcGFnZVggPSBlLnBhZ2VYO1xuICAgIGNvbnN0IHBhZ2VZID0gZS5wYWdlWTtcbiAgICBsZXQgeCA9IHBhZ2VYIC0gdGhpcy5fYm91bmRpbmdDbGllbnRSZWN0LmxlZnQ7O1xuICAgIGxldCB5ID0gcGFnZVkgLSB0aGlzLl9ib3VuZGluZ0NsaWVudFJlY3QudG9wOztcblxuICAgIHRoaXMuX29uTW92ZSh4LCB5KTtcbiAgfVxuXG4gIF9vbk1vdXNlVXAoZSkge1xuICAgIHRoaXMuX29uRW5kKCk7XG5cbiAgICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcignbW91c2Vtb3ZlJywgdGhpcy5fb25Nb3VzZU1vdmUpO1xuICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCdtb3VzZXVwJywgdGhpcy5fb25Nb3VzZVVwKTtcbiAgfVxuXG4gIC8vIHRvdWNoIGV2ZW50c1xuICBfb25Ub3VjaFN0YXJ0KGUpIHtcbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XG5cbiAgICBpZiAodGhpcy5fdG91Y2hJZCAhPT0gbnVsbCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIC8vIGNvbnNpZGVyIHRoZSBsYXN0IHRvdWNoIG9mIHRoZSBsaXN0LCBhcyBhbm90aGVyIHRvdWNoIG1pZ2h0IGhhdmVcbiAgICAvLyBvY2N1cmVkIHNvbWV3aGVyZSBlbHNlIG9uIHRoZSBzY3JlZW5cbiAgICBjb25zdCB0b3VjaCA9IGUudG91Y2hlc1tlLnRvdWNoZXMubGVuZ3RoIC0gMV07XG4gICAgY29uc3QgcGFnZVggPSB0b3VjaC5wYWdlWDtcbiAgICBjb25zdCBwYWdlWSA9IHRvdWNoLnBhZ2VZO1xuICAgIGNvbnN0IHggPSBwYWdlWCAtIHRoaXMuX2JvdW5kaW5nQ2xpZW50UmVjdC5sZWZ0O1xuICAgIGNvbnN0IHkgPSBwYWdlWSAtIHRoaXMuX2JvdW5kaW5nQ2xpZW50UmVjdC50b3A7XG5cbiAgICBpZiAodGhpcy5fb25TdGFydCh4LCB5KSA9PT0gdHJ1ZSkge1xuICAgICAgdGhpcy5fdG91Y2hJZCA9IHRvdWNoLmlkZW50aWZpZXI7XG4gICAgICAvLyBkaXNhYmxlIHRvdWNoc3RhcnRcbiAgICAgIHRoaXMuJGNhbnZhcy5yZW1vdmVFdmVudExpc3RlbmVyKCd0b3VjaHN0YXJ0JywgdGhpcy5fb25Ub3VjaFN0YXJ0KTtcblxuICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ3RvdWNobW92ZScsIHRoaXMuX29uVG91Y2hNb3ZlLCB7IHBhc3NpdmU6IGZhbHNlIH0pO1xuICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ3RvdWNoZW5kJywgdGhpcy5fb25Ub3VjaEVuZCk7XG4gICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigndG91Y2hjYW5jZWwnLCB0aGlzLl9vblRvdWNoRW5kKTtcbiAgICB9XG4gIH1cblxuICBfb25Ub3VjaE1vdmUoZSkge1xuICAgIGNvbnN0IHRvdWNoZXMgPSBBcnJheS5mcm9tKGUudG91Y2hlcyk7XG4gICAgY29uc3QgdG91Y2ggPSB0b3VjaGVzLmZpbHRlcih0ID0+IHQuaWRlbnRpZmllciA9PT0gdGhpcy5fdG91Y2hJZClbMF07XG5cbiAgICBpZiAodG91Y2gpIHtcbiAgICAgIGUucHJldmVudERlZmF1bHQoKTsgLy8gcHJldmVudCB0ZXh0IHNlbGVjdGlvblxuXG4gICAgICBjb25zdCBwYWdlWCA9IHRvdWNoLnBhZ2VYO1xuICAgICAgY29uc3QgcGFnZVkgPSB0b3VjaC5wYWdlWTtcbiAgICAgIGNvbnN0IHggPSBwYWdlWCAtIHRoaXMuX2JvdW5kaW5nQ2xpZW50UmVjdC5sZWZ0O1xuICAgICAgY29uc3QgeSA9IHBhZ2VZIC0gdGhpcy5fYm91bmRpbmdDbGllbnRSZWN0LnRvcDtcblxuICAgICAgdGhpcy5fb25Nb3ZlKHgsIHkpO1xuICAgIH1cbiAgfVxuXG4gIF9vblRvdWNoRW5kKGUpIHtcbiAgICBjb25zdCB0b3VjaGVzID0gQXJyYXkuZnJvbShlLnRvdWNoZXMpO1xuICAgIGNvbnN0IHRvdWNoID0gdG91Y2hlcy5maWx0ZXIoKHQpID0+IHQuaWRlbnRpZmllciA9PT0gdGhpcy5fdG91Y2hJZClbMF07XG5cbiAgICBpZiAodG91Y2ggPT09IHVuZGVmaW5lZCkge1xuICAgICAgdGhpcy5fb25FbmQoKTtcbiAgICAgIHRoaXMuX3RvdWNoSWQgPSBudWxsO1xuXG4gICAgICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcigndG91Y2htb3ZlJywgdGhpcy5fb25Ub3VjaE1vdmUpO1xuICAgICAgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3RvdWNoZW5kJywgdGhpcy5fb25Ub3VjaEVuZCk7XG4gICAgICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcigndG91Y2hjYW5jZWwnLCB0aGlzLl9vblRvdWNoRW5kKTtcbiAgICAgIC8vIHJlLWVuYWJsZSB0b3VjaHN0YXJ0XG4gICAgICB0aGlzLiRjYW52YXMuYWRkRXZlbnRMaXN0ZW5lcigndG91Y2hzdGFydCcsIHRoaXMuX29uVG91Y2hTdGFydCwgeyBwYXNzaXZlOiBmYWxzZSB9KTtcbiAgICB9XG4gIH1cblxuICBfdXBkYXRlUG9zaXRpb24oeCwgeSkge1xuICAgIGNvbnN0IHvCoG9yaWVudGF0aW9uLCBoZWlnaHQgfSA9IHRoaXMucGFyYW1zO1xuICAgIGNvbnN0IHBvc2l0aW9uID0gb3JpZW50YXRpb24gPT09ICdob3Jpem9udGFsJyA/IHggOiB5O1xuICAgIGNvbnN0IHZhbHVlID0gdGhpcy5zY3JlZW5TY2FsZS5pbnZlcnQocG9zaXRpb24pO1xuXG4gICAgdGhpcy5fdXBkYXRlVmFsdWUodmFsdWUsIGZhbHNlLCB0cnVlKTtcbiAgfVxuXG4gIF9yZW5kZXIoY2xpcHBlZFZhbHVlKSB7XG4gICAgY29uc3QgeyBiYWNrZ3JvdW5kQ29sb3IsIGZvcmVncm91bmRDb2xvciwgb3JpZW50YXRpb24gfSA9IHRoaXMucGFyYW1zO1xuICAgIGNvbnN0IGNhbnZhc1Bvc2l0aW9uID0gTWF0aC5yb3VuZCh0aGlzLmNhbnZhc1NjYWxlKGNsaXBwZWRWYWx1ZSkpO1xuICAgIGNvbnN0IHdpZHRoID0gdGhpcy5fY2FudmFzV2lkdGg7XG4gICAgY29uc3QgaGVpZ2h0ID0gdGhpcy5fY2FudmFzSGVpZ2h0O1xuICAgIGNvbnN0IGN0eCA9IHRoaXMuY3R4O1xuXG4gICAgY3R4LnNhdmUoKTtcbiAgICBjdHguY2xlYXJSZWN0KDAsIDAsIHdpZHRoLCBoZWlnaHQpO1xuXG4gICAgLy8gYmFja2dyb3VuZFxuICAgIGN0eC5maWxsU3R5bGUgPSBiYWNrZ3JvdW5kQ29sb3I7XG4gICAgY3R4LmZpbGxSZWN0KDAsIDAsIHdpZHRoLCBoZWlnaHQpO1xuXG4gICAgLy8gZm9yZWdyb3VuZFxuICAgIGN0eC5maWxsU3R5bGUgPSBmb3JlZ3JvdW5kQ29sb3I7XG5cbiAgICBpZiAob3JpZW50YXRpb24gPT09ICdob3Jpem9udGFsJylcbiAgICAgIGN0eC5maWxsUmVjdCgwLCAwLCBjYW52YXNQb3NpdGlvbiwgaGVpZ2h0KTtcbiAgICBlbHNlXG4gICAgICBjdHguZmlsbFJlY3QoMCwgY2FudmFzUG9zaXRpb24sIHdpZHRoLCBoZWlnaHQpO1xuXG4gICAgLy8gbWFya2Vyc1xuICAgIGNvbnN0IG1hcmtlcnMgPSB0aGlzLnBhcmFtcy5tYXJrZXJzO1xuXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBtYXJrZXJzLmxlbmd0aDsgaSsrKSB7XG4gICAgICBjb25zdCBtYXJrZXIgPSBtYXJrZXJzW2ldO1xuICAgICAgY29uc3QgcG9zaXRpb24gPSB0aGlzLmNhbnZhc1NjYWxlKG1hcmtlcik7XG4gICAgICBjdHguc3Ryb2tlU3R5bGUgPSAncmdiYSgyNTUsIDI1NSwgMjU1LCAwLjcpJztcbiAgICAgIGN0eC5iZWdpblBhdGgoKTtcblxuICAgICAgaWYgKG9yaWVudGF0aW9uID09PSAnaG9yaXpvbnRhbCcpIHtcbiAgICAgICAgY3R4Lm1vdmVUbyhwb3NpdGlvbiAtIDAuNSwgMSk7XG4gICAgICAgIGN0eC5saW5lVG8ocG9zaXRpb24gLSAwLjUsIGhlaWdodCAtIDEpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY3R4Lm1vdmVUbygxLCBoZWlnaHQgLSBwb3NpdGlvbiArIDAuNSk7XG4gICAgICAgIGN0eC5saW5lVG8od2lkdGggLSAxLCBoZWlnaHQgLSBwb3NpdGlvbiArIDAuNSk7XG4gICAgICB9XG5cbiAgICAgIGN0eC5jbG9zZVBhdGgoKTtcbiAgICAgIGN0eC5zdHJva2UoKTtcbiAgICB9XG5cbiAgICAvLyBoYW5kbGUgbW9kZVxuICAgIGlmICh0aGlzLnBhcmFtcy5tb2RlID09PSAnaGFuZGxlJyAmJiB0aGlzLnBhcmFtcy5zaG93SGFuZGxlKSB7XG4gICAgICBjb25zdCBkZWx0YSA9IHRoaXMucGFyYW1zLmhhbmRsZVNpemUgKiB0aGlzLl9waXhlbFJhdGlvIC8gMjtcbiAgICAgIGNvbnN0IHN0YXJ0ID0gY2FudmFzUG9zaXRpb24gLSBkZWx0YTtcbiAgICAgIGNvbnN0IGVuZCA9IGNhbnZhc1Bvc2l0aW9uICsgZGVsdGE7XG5cbiAgICAgIGN0eC5nbG9iYWxBbHBoYSA9IDE7XG4gICAgICBjdHguZmlsbFN0eWxlID0gdGhpcy5wYXJhbXMuaGFuZGxlQ29sb3I7XG5cbiAgICAgIGlmIChvcmllbnRhdGlvbiA9PT0gJ2hvcml6b250YWwnKSB7XG4gICAgICAgIGN0eC5maWxsUmVjdChzdGFydCwgMCwgZW5kIC0gc3RhcnQsIGhlaWdodCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjdHguZmlsbFJlY3QoMCwgc3RhcnQsIHdpZHRoLCBlbmQgLSBzdGFydCk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgY3R4LnJlc3RvcmUoKTtcbiAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBTbGlkZXI7XG4iXX0=